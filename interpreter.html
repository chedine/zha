<html>

<body>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/ramda/0.25.0/ramda.js"></script>
	<script src="lib.js"></script>
	<script src="types.js"></script>
	<script src="interpreter.js"></script>
	<script>
		
		/**
		* Clean all runtime libs by wrapping them as ZhaFn
		* Needs some thinking to clean this up
		**/
		
		for(key in rt){
			rt[key] = new ZhaFn(rt[key]);
		}
		var runtime = new ENV(undefined, rt);
		
		function parse() {
			var program = document.querySelector('#program').value;
			var results = run(program);
			document.querySelector('#programResults').value = results;
		}

		function run(program){
			var ast = read(program);
			var results = eval(ast);
			//console.log(results);
			return results;
		}
		function sampletests(){
			var p1 = `(def a 10) (add 5 a)`;
			console.log(p1, run(p1));
			p1 = `(def myfn (fn (a b c) (add (add a b) c)))`;
			console.log(p1, run(p1));
			p1 = `(myfn 1 2 3)`;
			console.log(p1, run(p1));
			p1 = `(((myfn 1) 2) 3)`;
			console.log(p1, run(p1));
			var p2 = `(def a1 10)
			(def a2 55)			
			(def a3 (fn (a b)
					   (add a b)
			))	
			(log (add 10 a1))`;
			console.log(p2, run(p2));
		}
		sampletests();
	</script>
	<h3>A rough interpreter</h3>
	<textarea cols="80" rows="5" id="program">echo 5 | add 3 | mul 2</textarea>
	<div style="margin-top:15px; margin-bottom:15px;">
		<input type="button" value="parse" onclick="parse()" />
	</div>
	<textarea cols="80" rows="3" id="programResults"></textarea>
</body>

</html>